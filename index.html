<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>lessons</title>
        <script src="phaser.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
                background: black;
            }
            

        </style>
    </head>
    <body>
                
    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(960, 420, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        function preload () {
            game.load.image('l0base', 'assets/l0_base.png');
            game.load.image('l0barriers', 'assets/l0_barriers.png');
            
            game.load.spritesheet('player', 'assets/player.png', 160, 224, 2);
            
            PIXI.scaleModes.DEFAULT = PIXI.scaleModes.NEAREST;
        }
        var cursors;
        
        var currentLevel = 0;
        
        var player;
        
        var barriersGraphic;
        var barriersCollisionGroup;
        
        var platforms;
                
        function create () {
            // Start physics and set general properties for game
            game.physics.startSystem(Phaser.Physics.ARCADE);
            
            game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
            game.scale.pageAlignVertically = true;
            game.stage.disableVisibilityChange = true;
            
            cursors = game.input.keyboard.createCursorKeys();
            
            addBase(currentLevel);
            
            barriersCollisionGroup = game.add.group();
            barriersCollisionGroup.enableBody = true;    
            addBarriers(currentLevel);
                        
            player = addPlayer(185, 138);

            
        }
        
        function update () {
            game.physics.arcade.collide(player, barriersCollisionGroup);
            
            if (player.body.touching.down) {
                if (cursors.left.isDown && player.body.velocity.x > -150 && !cursors.right.isDown) {
                    if (player.body.velocity.x > 0) { player.body.velocity.x = 0;}
                    player.body.velocity.x -= 30;
                } else if (cursors.right.isDown && player.body.velocity.x < 150 && !cursors.left.isDown) {
                    if (player.body.velocity.x < 0) { player.body.velocity.x = 0;}
                    player.body.velocity.x += 30;
                }
                
                if (player.body.velocity.x > 10) {
                    player.body.velocity.x -= 10;    
                } else if (player.body.velocity.x < -10) {
                        player.body.velocity.x += 10;
                } else {
                        player.body.velocity.x = 0;
                }

                
                if (cursors.up.isDown) {
                    player.body.velocity.y = -220;
                }
                
            } else { // In the air
                if (cursors.left.isDown && player.body.velocity.x > -100 && !cursors.right.isDown) {
                    if (player.body.velocity.x > 0) { player.body.velocity.x = 0;}
                    player.body.velocity.x -= 15;
                } else if (cursors.right.isDown && player.body.velocity.x < 100 && !cursors.left.isDown) {
                    if (player.body.velocity.x < 0) { player.body.velocity.x = 0;}
                    player.body.velocity.x += 15;
                }
                
            }
            
            if (player.body.velocity.x < 0) { player.frame = 1; }
            else if (player.body.velocity.x > 0) { player.frame = 0; }
            
            
            
        }
        
        // quinnn functions: less fun, more chungs
        
        function addPlayer(x, y) {
            var player = game.add.sprite(x, y, 'player');
            player.scale.setTo(0.1, 0.1);
            
            game.physics.arcade.enable(player);
            player.body.bounce.y = 0.1;
            player.body.gravity.y = 600;
            player.body.collideWorldBounds = true;
            player.body.maxVelocity.x = 180;
            
            return player;
        }
        
        function addBarriers(level) {
            barriersGraphic = game.add.sprite(0, 0, 'l' + level + 'barriers');
            barriersGraphic.scale.setTo(0.5, 0.5);
            var barrier;
            switch (level) {
                case 0: // Level 0 : Homestead
                    // Ground
                    barrier = barriersCollisionGroup.create(0, 385, null);
                    barrier.body.setSize(960, 168);
                    barrier.body.immovable = true;
                    
                    break;
            }
        }
            
        function addPlatforms(level) {
            
        }
            
        function addBase(level) {
            game.add.sprite(0, 0, 'l' + level + 'base').scale.setTo(0.5,0.5);
            switch (level) {
                case 0: game.stage.backgroundColor = '#ffb420'; break;
            }
        }
        

    };
    

    </script>

    </body>
</html>